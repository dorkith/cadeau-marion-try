<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Jeu du mot de passe impossible</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0f0f23;
      color: #f2f2f2;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
    }
    input, button {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      margin-top: 10px;
      border-radius: 5px;
      border: none;
      box-sizing: border-box;
    }
    input {
      background: #1c1c3c;
      color: #eee;
    }
    button {
      background: #1f8a70;
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background: #16664e;
    }
    .success { color: #4caf50; margin-top: 10px; }
    .error { color: #f44336; margin-top: 10px; }
    ul { padding-left: 20px; }
    li { margin-bottom: 8px; }
    #rulesList {
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🧠 Le Mot de Passe Impossible</h1>
    <h2>Respecte toutes les règles pour trouver LA bonne phrase !</h2>

    <h3>Règle à respecter :</h3>
    <ul id="rulesList"></ul>

    <input id="answerInput" type="text" placeholder="Tape ta proposition ici..." autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" />
    <button id="submitBtn" disabled>Valider</button>

    <p id="message"></p>
    <p id="stats"></p>
  </div>

  <script>
    const rules = [
      {
        text: "La phrase commence par une majuscule.",
        test: str => /^[A-ZÀÂÄÉÈÊËÏÎÔÖÙÛÜÇ]/.test(str),
      },
      {
        text: "La phrase contient exactement 6 mots.",
        test: str => str.trim().split(/\s+/).length === 6,
      },
      {
        text: "La phrase contient une virgule.",
        test: str => /,/.test(str),
      },
      {
        text: "La phrase contient un pronom personnel (je, tu, il...).",
        test: str => /\b(je|tu|il|elle|on|nous|vous|ils|elles)\b/i.test(str),
      },
      {
        text: "La phrase contient une contraction (ex: t'offre, j'aime...).",
        test: str => /\b(j'|t'|l'|n'|s')\w+/i.test(str),
      },
      {
        text: "La phrase contient au moins 3 lettres accentuées.",
        test: str => [...str].filter(c => "àâäéèêëïîôöùûüç".includes(c.toLowerCase())).length >= 3,
      },
      {
        text: "Le mot juste après la virgule commence par un 'j' minuscule.",
        test: str => {
          const parts = str.split(',');
          if (parts.length < 2) return false;
          return parts[1].trim().startsWith('j');
        }
      },
      {
        text: "Le mot 'abonnement' est présent mais n'est pas le dernier mot.",
        test: str => {
          const words = str.trim().toLowerCase().replace(/[.,!?]/g, '').split(/\s+/);
          return words.includes("abonnement") && words[words.length - 1] !== "abonnement";
        }
      },
      {
        text: "Le dernier mot commence par un 'M' majuscule.",
        test: str => {
          const words = str.trim().split(/\s+/);
          return words[words.length -1].startsWith("M");
        }
      },
      {
        text: "La phrase exacte est respectée (sans indice direct) : elle doit correspondre à la phrase finale.",
        test: str => str === "Félicitation, je t'offre un abonnement Médiapart."
      }
    ];

    let step = 0;
    let attempts = 0;
    const startTime = Date.now();

    const answerInput = document.getElementById("answerInput");
    const submitBtn = document.getElementById("submitBtn");
    const messageDiv = document.getElementById("message");
    const rulesList = document.getElementById("rulesList");
    const statsDiv = document.getElementById("stats");

    function showRule() {
      rulesList.innerHTML = "";
      const li = document.createElement("li");
      li.textContent = rules[step].text;
      rulesList.appendChild(li);
    }

    function updateStats() {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      statsDiv.textContent = `Tentatives : ${attempts} | Temps écoulé : ${elapsed} sec`;
    }

    // Active ou désactive le bouton selon le contenu
    answerInput.addEventListener("input", () => {
      submitBtn.disabled = answerInput.value.trim().length === 0;
      messageDiv.textContent = "";
    });

    submitBtn.addEventListener("click", () => {
      const input = answerInput.value.trim();
      if (!input) return;

      attempts++;

      if (rules[step].test(input)) {
        step++;
        messageDiv.textContent = "✅ Bien joué, règle validée !";
        messageDiv.className = "success";
        if (step === rules.length) {
          messageDiv.textContent = "🎉 Félicitations ! Tu as trouvé la phrase parfaite.";
          submitBtn.disabled = true;
          answerInput.disabled = true;
          rulesList.innerHTML = "";
        } else {
          showRule();
        }
      } else {
        messageDiv.textContent = "❌ Oups, ta phrase ne respecte pas la règle actuelle.";
        messageDiv.className = "error";
      }
      updateStats();
    });

    answerInput.addEventListener("keypress", e => {
      if (e.key === "Enter" && !submitBtn.disabled) submitBtn.click();
    });

    // Initialisation
    showRule();
    updateStats();
  </script>
</body>
</html>
