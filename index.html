<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Jeu mot de passe progressif (25 r√®gles subtiles)</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2em auto; }
  input { width: 100%; padding: 0.5em; font-size: 1.2em; }
  button { margin-top: 1em; padding: 0.7em 1.2em; font-size: 1.1em; }
  .success { color: green; margin-top: 1em; }
  .error { color: red; margin-top: 1em; }
  .rule { font-style: italic; margin-top: 1em; }
</style>
</head>
<body>

<h2>Jeu du mot de passe progressif (25 r√®gles subtiles)</h2>
<p>Construis la phrase finale en respectant chaque contrainte, une par une. Les contraintes s'empilent !</p>

<div id="rule" class="rule"></div>

<input type="text" id="answer" placeholder="Ta r√©ponse ici" autofocus autocomplete="off" />
<button id="submitBtn">Valider</button>

<div id="message"></div>

<script>
  const finalPhrase = "F√©licitations, je t'offre un abonnement M√©diapart.";

  const rules = [
    "La premi√®re lettre de la r√©ponse est une majuscule.",
    "La r√©ponse contient au moins une voyelle accentu√©e (√©, √®, √™, etc.).",
    "La r√©ponse contient une apostrophe (').",
    "La r√©ponse contient au moins une virgule.",
    "La r√©ponse comporte entre 30 et 40 caract√®res.",
    "La r√©ponse contient exactement 6 espaces.",
    "Le premier mot fait au moins 6 lettres.",
    "Le dernier caract√®re est un point.",
    "La r√©ponse contient au moins un mot de 2 lettres.",
    "Il y a un mot avec un double 't'.",
    "Le texte ne contient pas la lettre 'z'.",
    "Il y a un mot qui commence par un 'j' minuscule.",
    "Le texte contient la lettre 'o' au moins 3 fois.",
    "Le mot contenant l‚Äôapostrophe commence par 't'.",
    "La virgule est plac√©e entre le premier et le deuxi√®me mot.",
    "Le nombre total de lettres (sans espaces) est 32.",
    "Le texte ne contient pas de majuscule autre qu‚Äôau premier mot et au dernier mot.",
    "Le dernier mot commence par 'M'.",
    "Le mot avec un double 't' est avant le dernier mot.",
    "Le mot 'je' appara√Æt dans le texte.",
    "Le mot contenant l‚Äôapostrophe est directement apr√®s 'je'.",
    "Le dernier mot est exactement 'M√©diapart'.",
    "Le texte contient le mot 'abonnement'.",
    "La phrase est sensible √† la casse (majuscule et minuscules).",
    "La phrase finale exacte est :<br><strong>F√©licitations, je t'offre un abonnement M√©diapart.</strong>"
  ];

  let step = 0;

  const ruleDiv = document.getElementById('rule');
  const answerInput = document.getElementById('answer');
  const submitBtn = document.getElementById('submitBtn');
  const messageDiv = document.getElementById('message');

  function countWords(str) {
    return str.trim().split(/\s+/).length;
  }

  function countLetters(str) {
    return str.replace(/\s/g, '').length;
  }

  function hasDoubleLetter(str, letter) {
    const re = new RegExp(letter+letter, 'i');
    return re.test(str);
  }

  function checkCapitalization(word, shouldBeCapital) {
    if (shouldBeCapital) {
      return /^[A-Z√Ä√Ç√â√à√ä√ã√é√è√î√ô√õ√ú√á]/.test(word);
    } else {
      return /^[a-z√†√¢√©√®√™√´√Æ√Ø√¥√π√ª√º√ß]/.test(word);
    }
  }

  function checkAnswer(answer) {
    // On v√©rifie toutes les r√®gles pr√©c√©dentes aussi
    for(let i=0; i<=step; i++){
      if(!checkSingleRule(answer, i)) return false;
    }
    return true;
  }

  function checkSingleRule(answer, ruleIndex) {
    switch(ruleIndex) {
      case 0:
        // Premi√®re lettre majuscule
        return /^[A-Z√Ä√Ç√â√à√ä√ã√é√è√î√ô√õ√ú√á]/.test(answer);
      case 1:
        // Au moins une voyelle accentu√©e
        return /[√©√®√™√´√†√¢√Æ√Ø√¥√ª√π]/i.test(answer);
      case 2:
        // Contient apostrophe
        return answer.includes("'");
      case 3:
        // Contient virgule
        return answer.includes(",");
      case 4:
        // 30 √† 40 caract√®res
        return answer.length >=30 && answer.length <=40;
      case 5:
        // 6 espaces
        return (answer.match(/ /g) || []).length === 6;
      case 6:
        // Premier mot >= 6 lettres
        const firstWord = answer.trim().split(' ')[0];
        return firstWord.length >=6;
      case 7:
        // Finit par point
        return answer.endsWith('.');
      case 8:
        // Au moins un mot de 2 lettres
        return answer.trim().split(' ').some(w => w.length === 2);
      case 9:
        // Un mot avec double 't'
        return /tt/.test(answer);
      case 10:
        // Pas de lettre z
        return !/z/i.test(answer);
      case 11:
        // Mot qui commence par 'j' minuscule
        return answer.trim().split(' ').some(w => /^j/.test(w));
      case 12:
        // Lettre o au moins 3 fois
        return (answer.match(/o/gi) || []).length >= 3;
      case 13:
        // Mot avec apostrophe commence par 't'
        const wordsWithApostrophe = answer.match(/\b\w+'\w+\b/g) || [];
        return wordsWithApostrophe.some(w => /^t/.test(w));
      case 14:
        // Virgule entre 1er et 2e mot
        const commaIndex = answer.indexOf(',');
        const firstSpace = answer.indexOf(' ');
        return commaIndex > firstSpace && commaIndex < answer.indexOf(' ', firstSpace + 1);
      case 15:
        // 32 lettres (sans espaces)
        return countLetters(answer) === 32;
      case 16:
        // Majuscule seulement au premier et dernier mot
        const words = answer.trim().split(' ');
        for(let i=1; i<words.length-1; i++){
          if(/[A-Z√Ä√Ç√â√à√ä√ã√é√è√î√ô√õ√ú√á]/.test(words[i][0])){
            return false;
          }
        }
        return true;
      case 17:
        // Dernier mot commence par M
        const lastWord = answer.trim().split(' ').slice(-1)[0].replace(/\.$/, '');
        return /^M/.test(lastWord);
      case 18:
        // Mot avec double t avant dernier mot
        const allWords = answer.trim().split(' ');
        const doubleTWordIndex = allWords.findIndex(w => /tt/.test(w));
        return doubleTWordIndex !== -1 && doubleTWordIndex < allWords.length -1;
      case 19:
        // Mot 'je' dans le texte
        return /\bje\b/.test(answer);
      case 20:
        // Mot avec apostrophe juste apr√®s 'je'
        // on cherche "je t'offre"
        return /\bje t'offre\b/.test(answer);
      case 21:
        // Dernier mot = M√©diapart
        const lw = answer.trim().split(' ').slice(-1)[0].replace(/\.$/, '');
        return lw === 'M√©diapart';
      case 22:
        // Contient mot 'abonnement'
        return /\babonnement\b/.test(answer);
      case 23:
        // Sensible √† la casse (on v√©rifie que la r√©ponse est exactement celle qu'on attend pour les maj/min)
        // Ici on compare avec la phrase finale mais en ne validant que si les lettres en maj/min sont respect√©es
        // Simplifions en validant que la phrase est √©gale au final en casse
        // La vraie v√©rification finale est en r√®gle 24
        return true; 
      case 24:
        // Phrase finale exacte
        return answer === finalPhrase;
      default:
        return false;
    }
  }

  submitBtn.addEventListener('click', () => {
    const answer = answerInput.value.trim();

    if (checkAnswer(answer)) {
      step++;
      if (step === rules.length) {
        messageDiv.innerHTML = "<span class='success'>Bravo ! Tu as r√©ussi √† construire la phrase finale ! üéâ</span>";
        ruleDiv.textContent = "";
        answerInput.disabled = true;
        submitBtn.disabled = true;
      } else {
        messageDiv.innerHTML = "<span class='success'>Correct ! Passons √† la r√®gle suivante.</span>";
        showRule();
      }
    } else {
      messageDiv.innerHTML = "<span class='error'>Oups, cette r√©ponse ne respecte pas la r√®gle. Essaie encore !</span>";
    }
  });

  function showRule() {
    ruleDiv.innerHTML = `R√®gle #${step + 1} : ${rules[step]}`;
    messageDiv.textContent = "";
    answerInput.value = "";
    answerInput.focus();
  }

  showRule();
</script>

</body>
</html>
