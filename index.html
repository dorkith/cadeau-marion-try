<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jeu du Mot de Passe Progressif</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap');

    body {
      font-family: 'Patrick Hand', cursive, sans-serif;
      background: linear-gradient(135deg, #2a324b, #4b5671);
      color: #eee;
      margin: 0; padding: 20px;
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
    }

    h1 {
      margin-bottom: 10px;
      text-shadow: 2px 2px 5px #0008;
    }

    #rules-container {
      background: #1e2433dd;
      border-radius: 8px;
      box-shadow: inset 0 0 20px #0009;
      max-height: 320px;
      width: 90vw;
      max-width: 700px;
      overflow-y: auto;
      padding: 15px 20px;
      margin-bottom: 20px;
    }

    .rule-item {
      margin-bottom: 6px;
      padding: 6px 10px;
      border-radius: 6px;
      background: #3b4a73aa;
      transition: background-color 0.3s;
      font-size: 1.1em;
    }

    .rule-item.current {
      background: #94c973cc;
      color: #1b2e03;
      font-weight: bold;
      box-shadow: 0 0 8px 2px #a0d03dcc;
    }

    #input-container {
      width: 90vw;
      max-width: 700px;
      display: flex;
      flex-wrap: nowrap;
      gap: 10px;
      margin-bottom: 15px;
    }

    #answer-input {
      flex-grow: 1;
      font-size: 1.3em;
      padding: 10px 15px;
      border-radius: 8px;
      border: none;
      outline: none;
      box-shadow: 0 0 10px #0008 inset;
      transition: box-shadow 0.3s;
    }
    #answer-input:focus {
      box-shadow: 0 0 14px #94c973cc inset;
      background: #e9f0d1aa;
      color: #1b2e03;
    }

    #submit-btn {
      font-size: 1.2em;
      padding: 0 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #94c973cc;
      color: #1b2e03;
      font-weight: bold;
      box-shadow: 0 0 12px #a0d03dcc;
      transition: background-color 0.3s;
    }
    #submit-btn:hover:not(:disabled) {
      background: #b0e576cc;
    }
    #submit-btn:disabled {
      background: #66775588;
      cursor: not-allowed;
      box-shadow: none;
    }

    #message {
      font-size: 1.3em;
      margin-bottom: 10px;
      min-height: 28px;
      font-weight: bold;
      text-align: center;
    }
    #message.error {
      color: #ff5c5c;
      text-shadow: 1px 1px 3px #900;
    }
    #message.success {
      color: #a2d03d;
      text-shadow: 1px 1px 3px #0a0;
    }

    #stats {
      font-size: 1em;
      margin-bottom: 15px;
      color: #bbb;
      user-select: none;
    }

    /* Clignotement rouge pour erreur */
    @keyframes flashRed {
      0%, 100% { background-color: transparent; }
      50% { background-color: rgba(255, 0, 0, 0.5); }
    }
    .flash-error {
      animation: flashRed 0.5s 3;
    }

    /* Contour vert pour succ√®s */
    .success-glow {
      box-shadow: 0 0 25px 6px #32CD32 inset;
      transition: box-shadow 0.5s ease;
    }

    /* Confettis */
    .confetti-piece {
      position: fixed;
      top: 0;
      width: 7px;
      height: 10px;
      opacity: 0.9;
      z-index: 9999;
      pointer-events: none;
      animation-name: confetti-fall;
      animation-timing-function: linear;
      animation-iteration-count: 1;
      transform-origin: center;
    }

    @keyframes confetti-fall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body>

  <h1>Jeu du Mot de Passe Progressif</h1>

  <div id="rules-container"></div>

  <div id="input-container">
    <input id="answer-input" type="text" autocomplete="off" placeholder="Tape ta r√©ponse ici..." />
    <button id="submit-btn">Valider</button>
  </div>

  <div id="message"></div>

  <div id="stats">Essais : 0 | Temps √©coul√© : 0:00</div>

<script>
  const rules = [
    "La r√©ponse doit commencer par une majuscule.",
    "La r√©ponse doit contenir au moins une voyelle accentu√©e (√©, √®, √™, etc.).",
    "La r√©ponse doit contenir au moins une apostrophe (').",
    "La r√©ponse doit contenir une virgule (,).",
    "Le nombre de caract√®res (hors espaces) doit √™tre entre 30 et 40.",
    "La r√©ponse doit contenir exactement 6 espaces.",
    "Le premier mot doit contenir au moins 6 lettres.",
    "La r√©ponse doit se terminer par un point (.).",
    "La r√©ponse doit contenir au moins un mot de 2 lettres.",
    "La r√©ponse doit contenir au moins un mot avec un double 't'.",
    "La r√©ponse ne doit pas contenir la lettre 'z' ou 'Z'.",
    "La r√©ponse doit contenir au moins un mot commen√ßant par 'j' minuscule.",
    "La r√©ponse doit contenir la lettre 'o' au moins 3 fois.",
    "La r√©ponse doit contenir au moins un mot avec une apostrophe qui commence par 't'.",
    "La virgule doit √™tre plac√©e juste apr√®s le premier mot, sans espace.",
    "Le nombre de lettres (hors espaces) doit √™tre exactement 32.",
    "Aucune majuscule autre que celle du premier et du dernier mot ne doit appara√Ætre.",
    "Le dernier mot doit commencer par un 'M' majuscule.",
    "Le mot avec double 't' doit √™tre plac√© avant le dernier mot.",
    "Le mot 'je' doit appara√Ætre dans la r√©ponse.",
    "Un mot avec une apostrophe doit appara√Ætre juste apr√®s 'je'.",
    "Le dernier mot doit √™tre 'M√©diapart'.",
    "La r√©ponse doit contenir le mot 'abonnement'.",
    "La casse doit √™tre respect√©e exactement (pas d'espaces superflus).",
    "La phrase doit √™tre exactement : F√©licitations, je t'offre un abonnement M√©diapart."
  ];

  const finalPhrase = "F√©licitations, je t'offre un abonnement M√©diapart.";

  let step = 0;
  let attempts = 0;
  let startTime = Date.now();
  let timerInterval;

  const rulesContainer = document.getElementById('rules-container');
  const answerInput = document.getElementById('answer-input');
  const submitBtn = document.getElementById('submit-btn');
  const messageDiv = document.getElementById('message');
  const statsDiv = document.getElementById('stats');
  const body = document.body;

  // Sons succ√®s / erreur (tu peux remplacer les urls par les tiens)
  const successSound = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
  const errorSound = new Audio('https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg');

  function playErrorEffect(){
    body.classList.add('flash-error');
    errorSound.currentTime = 0;
    errorSound.play();
    setTimeout(() => {
      body.classList.remove('flash-error');
    }, 1500);
  }

  function playSuccessEffect(){
    body.classList.add('success-glow');
    successSound.currentTime = 0;
    successSound.play();
    setTimeout(() => {
      body.classList.remove('success-glow');
    }, 1500);
  }

  // Fonction utilitaire pour compter lettres hors espaces
  function countLetters(text){
    return text.replace(/ /g, '').length;
  }

  function getFirstWord(text){
    const words = text.trim().split(/\s+/);
    return words[0] || "";
  }

  function hasWordMinTwoLetters(text){
    const words = text.trim().split(/\s+/);
    return words.some(w => w.length >= 2);
  }

  function hasWordStartingJMin(text){
    const words = text.trim().split(/\s+/);
    return words.some(w => w[0] === 'j');
  }

  function checkAnswer(a) {
    for(let i=0; i<=step; i++){
      switch(i){
        case 0:
          // commence par majuscule
          if(!/^[A-Z√Ä√Ç√Ñ√á√â√à√ä√ã√è√é√î√ñ√ô√õ√ú√Ü≈í]/.test(a)) return false;
          break;
        case 1:
          // voyelle accentu√©e
          if(!/[√©√®√™√´√†√¢√§√Æ√Ø√¥√∂√π√ª√º]/i.test(a)) return false;
          break;
        case 2:
          // apostrophe
          if(!/\'/.test(a)) return false;
          break;
        case 3:
          // virgule
          if(!/,/.test(a)) return false;
          break;
        case 4:
          // longueur 30-40 lettres hors espaces
          const len = countLetters(a);
          if(len < 30 || len > 40) return false;
          break;
        case 5:
          // 6 espaces
          const spaces = (a.match(/ /g) || []).length;
          if(spaces !== 6) return false;
          break;
        case 6:
          // premier mot >= 6 lettres
          const firstWord = getFirstWord(a);
          if(firstWord.length < 6) return false;
          break;
        case 7:
          // se termine par point
          if(!/\.$/.test(a)) return false;
          break;
        case 8:
          // mot d'au moins 2 lettres (v√©rifi√© aussi step2)
          if(!hasWordMinTwoLetters(a)) return false;
          break;
        case 9:
          // mot avec double 't'
          if(!/\b\w*t{2}\w*\b/i.test(a)) return false;
          break;
        case 10:
          // pas de z ou Z
          if(/[zZ]/.test(a)) return false;
          break;
        case 11:
          // mot commen√ßant par j minuscule
          if(!hasWordStartingJMin(a)) return false;
          break;
        case 12:
          // lettre 'o' au moins 3 fois
          if((a.match(/o/gi) || []).length < 3) return false;
          break;
        case 13:
          // mot avec apostrophe commen√ßant par t
          if(!/\b[tT]\'\w+\b/.test(a)) return false;
          break;
        case 14:
          // virgule juste apr√®s premier mot sans espace
          if(!new RegExp(`^${firstWord},`).test(a)) return false;
          break;
        case 15:
          // longueur lettres hors espaces = 32
          if(countLetters(a) !== 32) return false;
          break;
        case 16:
          // majuscule uniquement 1√®re lettre 1er et dernier mot
          const words = a.trim().split(/\s+/);
          for(let k=1; k<words.length-1; k++){
            if(/[A-Z√Ä√Ç√Ñ√á√â√à√ä√ã√è√é√î√ñ√ô√õ√ú√Ü≈í]/.test(words[k][0])) return false;
          }
          if(!/^[A-Z√Ä√Ç√Ñ√á√â√à√ä√ã√è√é√î√ñ√ô√õ√ú√Ü≈í]/.test(words[0])) return false;
          if(!/^[A-Z√Ä√Ç√Ñ√á√â√à√ä√ã√è√é√î√ñ√ô√õ√ú√Ü≈í]/.test(words[words.length-1])) return false;
          break;
        case 17:
          // dernier mot commence par M majuscule
          const lastWord = a.trim().split(/\s+/).slice(-1)[0];
          if(!/^M/.test(lastWord)) return false;
          break;
        case 18:
          // mot avec double t avant dernier mot
          const idxDoubleT = a.toLowerCase().split(/\s+/).findIndex(w => w.includes('tt'));
          const idxLast = a.trim().split(/\s+/).length - 1;
          if(idxDoubleT === -1 || idxDoubleT >= idxLast) return false;
          break;
        case 19:
          // mot 'je' pr√©sent
          if(!/\bje\b/.test(a.toLowerCase())) return false;
          break;
        case 20:
          // mot avec apostrophe juste apr√®s 'je'
          if(!/\bje t\'\w+/.test(a.toLowerCase())) return false;
          break;
        case 21:
          // dernier mot = M√©diapart
          if(!a.trim().endsWith("M√©diapart.")) return false;
          break;
        case 22:
          // contient 'abonnement'
          if(!/\babonnement\b/.test(a.toLowerCase())) return false;
          break;
        case 23:
          // casse exacte, pas d'espaces superflus
          if(a !== a.trim()) return false;
          // on va v√©rifier que la casse correspond bien √† la phrase finale sur la portion √©crite
          // on v√©rifie uniquement que l'input ne diff√®re pas de la portion de phrase avant le point final
          // C'est compliqu√© ici, on fait simple : comparer √† la phrase finale jusqu'√† la longueur entr√©e
          if(!finalPhrase.startsWith(a)) return false;
          break;
        case 24:
          // phrase exacte finale
          if(a !== finalPhrase) return false;
          break;
      }
    }
    return true;
  }

  // Affichage dynamique
  function showRules(){
    rulesContainer.innerHTML = '';
    for(let i=0; i<=step; i++){
      const div = document.createElement('div');
      div.className = 'rule-item' + (i === step ? ' current' : '');
      div.textContent = `R√®gle ${i+1} : ${rules[i]}`;
      rulesContainer.appendChild(div);
    }
    // Scroll vers la r√®gle courante
    rulesContainer.scrollTop = rulesContainer.scrollHeight;
  }

  // Stats timer + essais
  function updateStats(){
    attempts++;
    const elapsedMs = Date.now() - startTime;
    const minutes = Math.floor(elapsedMs / 60000);
    const seconds = Math.floor((elapsedMs % 60000)/1000);
    statsDiv.textContent = `Essais : ${attempts} | Temps √©coul√© : ${minutes}:${seconds.toString().padStart(2,'0')}`;
  }

  function createConfetti(){
    const colors = ['#ff0', '#0ff', '#f0f', '#0f0', '#f00', '#00f', '#ffa500'];
    const count = 150;
    for(let i=0; i<count; i++){
      const confetti = document.createElement('div');
      confetti.className = 'confetti-piece';
      confetti.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
      confetti.style.left = Math.random()*100 + 'vw';
      confetti.style.animationDuration = (Math.random()*3 + 2) + 's';
      confetti.style.animationDelay = (Math.random()*5) + 's';
      confetti.style.transform = `rotate(${Math.random()*360}deg)`;
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 7000);
    }
  }

  // Gestion du clic sur valider
  submitBtn.addEventListener('click', () => {
    const answer = answerInput.value.trim();
    if(!answer) return;

    if(checkAnswer(answer)){
      playSuccessEffect();
      messageDiv.textContent = "Correct !";
      messageDiv.className = "success";
      step++;
      updateStats();
      if(step >= rules.length){
        messageDiv.innerHTML = `<strong>üéâ Bravo ! Vous avez compl√©t√© toutes les r√®gles ! üéâ</strong>`;
        createConfetti();
        submitBtn.disabled = true;
        answerInput.disabled = true;
        clearInterval(timerInterval);
        showRules();
        return;
      }
      showRules();
      answerInput.value = '';
      answerInput.focus();
    } else {
      messageDiv.textContent = "Erreur, essaie encore.";
      messageDiv.className = "error";
      playErrorEffect();
      updateStats();
      answerInput.focus();
    }
  });

  // Timer mise √† jour chaque seconde
  timerInterval = setInterval(() => {
    const elapsedMs = Date.now() - startTime;
    const minutes = Math.floor(elapsedMs / 60000);
    const seconds = Math.floor((elapsedMs % 60000)/1000);
    statsDiv.textContent = `Essais : ${attempts} | Temps √©coul√© : ${minutes}:${seconds.toString().padStart(2,'0')}`;
  }, 1000);

  // Initialisation
  showRules();
  answerInput.focus();

  // Permet appuyer sur Enter dans input pour valider
  answerInput.addEventListener('keydown', e => {
    if(e.key === 'Enter'){
      submitBtn.click();
      e.preventDefault();
    }
  });
</script>

</body>
</html>
