<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Jeu mot de passe progressif (25 r√®gles)</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap');

  body {
    font-family: 'Patrick Hand', cursive, Arial, sans-serif;
    background: linear-gradient(135deg, #4e54c8, #8f94fb);
    color: #fff;
    max-width: 650px;
    margin: 2em auto;
    padding: 1.5em 2em;
    border-radius: 15px;
    box-shadow: 0 0 40px rgba(255, 255, 255, 0.3);
    display: flex;
    flex-direction: column;
    height: 90vh;
  }

  h2 {
    text-align: center;
    font-weight: 700;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
  }

  p {
    text-align: center;
    font-size: 1.1em;
    margin-bottom: 1em;
    text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
  }

  #rulesContainer {
    flex: 1;
    overflow-y: auto;
    margin-bottom: 1em;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 1em;
    box-shadow: inset 0 0 15px rgba(0,0,0,0.3);
  }

  .rule-item {
    margin-bottom: 1em;
    padding: 0.6em 1em;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.15);
    box-shadow: inset 0 0 8px rgba(0,0,0,0.2);
    transition: background-color 0.3s ease;
    font-size: 1.2em;
  }

  .rule-item.current {
    background: #ffd700;
    color: #4e54c8;
    font-weight: 700;
    box-shadow: 0 0 12px #ffea00;
  }

  input[type="text"] {
    width: 100%;
    padding: 0.7em 1em;
    font-size: 1.4em;
    border-radius: 10px;
    border: none;
    outline: none;
    box-shadow: 0 0 10px rgba(255,255,255,0.5);
    transition: box-shadow 0.3s ease;
  }

  input[type="text"]:focus {
    box-shadow: 0 0 15px #ffd700;
  }

  button {
    margin-top: 0.8em;
    padding: 0.9em 2em;
    font-size: 1.3em;
    background: #ffd700;
    color: #4e54c8;
    font-weight: 700;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 5px 15px #b38f00;
    transition: background-color 0.3s ease, color 0.3s ease;
    width: 100%;
  }

  button:hover:not(:disabled) {
    background-color: #ffea00;
    color: #3a3f87;
  }

  button:disabled {
    background-color: #999;
    color: #555;
    cursor: default;
  }

  #message {
    margin-top: 1em;
    font-size: 1.2em;
    min-height: 1.6em;
    text-align: center;
    font-weight: 600;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
  }

  .success {
    color: #a5d6a7;
  }

  .error {
    color: #ef9a9a;
  }

  #stats {
    margin-top: 0.7em;
    font-size: 1em;
    text-align: center;
    color: #ddd;
    user-select: none;
  }

  /* Confettis animation */
  .confetti-piece {
    position: fixed;
    width: 10px;
    height: 15px;
    background-color: #ffd700;
    opacity: 0.9;
    z-index: 9999;
    top: -20px;
    animation-name: fallConfetti;
    animation-timing-function: ease-in-out;
    animation-iteration-count: infinite;
    animation-duration: 4s;
    border-radius: 3px;
    filter: drop-shadow(0 0 2px #b38f00);
  }

  @keyframes fallConfetti {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
  }
</style>
</head>
<body>

<h2>Jeu mot de passe progressif (25 r√®gles subtiles)</h2>
<p>Construis la phrase finale en respectant chaque contrainte, une par une. Les contraintes s'empilent !</p>

<div id="rulesContainer">
  <!-- Les r√®gles valid√©es + la courante s'affichent ici -->
</div>

<input type="text" id="answer" placeholder="Ta r√©ponse ici" autofocus autocomplete="off" />
<button id="submitBtn">Valider</button>

<div id="message"></div>
<div id="stats">Essais : 0 | Temps √©coul√© : 0:00</div>

<script>
  // Phrase finale
  const finalPhrase = "F√©licitations, je t'offre un abonnement M√©diapart.";

  // R√®gles cumulatives
  const rules = [
    "La premi√®re lettre de la r√©ponse est une majuscule.",
    "La r√©ponse contient au moins une voyelle accentu√©e (√©, √®, √™, etc.).",
    "La r√©ponse contient une apostrophe (').",
    "La r√©ponse contient au moins une virgule.",
    "La r√©ponse comporte entre 30 et 40 caract√®res.",
    "La r√©ponse contient exactement 6 espaces.",
    "Le premier mot fait au moins 6 lettres.",
    "Le dernier caract√®re est un point.",
    "La r√©ponse contient au moins un mot de 2 lettres.",
    "Il y a un mot avec un double 't'.",
    "Le texte ne contient pas la lettre 'z'.",
    "Il y a un mot qui commence par un 'j' minuscule.",
    "Le texte contient la lettre 'o' au moins 3 fois.",
    "Le mot contenant l‚Äôapostrophe commence par 't'.",
    "La virgule est plac√©e entre le premier et le deuxi√®me mot.",
    "Le nombre total de lettres (sans espaces) est 32.",
    "Le texte ne contient pas de majuscule autre qu‚Äôau premier mot et au dernier mot.",
    "Le dernier mot commence par 'M'.",
    "Le mot avec un double 't' est avant le dernier mot.",
    "Le mot 'je' appara√Æt dans le texte.",
    "Le mot contenant l‚Äôapostrophe est directement apr√®s 'je'.",
    "Le dernier mot est exactement 'M√©diapart'.",
    "Le texte contient le mot 'abonnement'.",
    "La phrase est sensible √† la casse (majuscule et minuscules).",
    "La phrase finale exacte est : F√©licitations, je t'offre un abonnement M√©diapart."
  ];

  // √âl√©ments DOM
  const rulesContainer = document.getElementById('rulesContainer');
  const answerInput = document.getElementById('answer');
  const submitBtn = document.getElementById('submitBtn');
  const messageDiv = document.getElementById('message');
  const statsDiv = document.getElementById('stats');

  let step = 0;
  let attempts = 0;
  let startTime = Date.now();
  let timerInterval;

  // Sons (synth√®se simple)
  function playSound(type) {
    try {
      const context = new AudioContext();
      const o = context.createOscillator();
      const g = context.createGain();
      o.connect(g);
      g.connect(context.destination);

      if(type === 'success'){
        o.frequency.value = 880;
        g.gain.setValueAtTime(0.2, context.currentTime);
        o.start();
        o.stop(context.currentTime + 0.15);
      } else if(type === 'error'){
        o.frequency.value = 220;
        g.gain.setValueAtTime(0.2, context.currentTime);
        o.start();
        o.stop(context.currentTime + 0.3);
      }
    } catch(e) {
      // AudioContext peut ne pas √™tre dispo (mobile ou bloqueur)
      console.log('Audio non support√© ou bloqu√©');
    }
  }

  function countLetters(str) {
    return str.replace(/\s/g, '').length;
  }

  // Correction r√®gle 6 : r√©cup√®re le premier mot avec un split propre
  function getFirstWord(text){
    // Split sur espace multiple, filtre les vides
    const words = text.trim().split(/\s+/);
    return words[0] || "";
  }

  // Correction r√®gle 9: au moins un mot de 2 lettres
  function hasWordMinTwoLetters(text){
    const words = text.trim().split(/\s+/);
    return words.some(w => w.length >= 2);
  }

  // Correction r√®gle 12 : mot qui commence par 'j' minuscule
  function hasWordStartingJMin(text){
    const words = text.trim().split(/\s+/);
    return words.some(w => w[0] === 'j');
  }

  // Check r√©ponse selon la r√®gle courante
  function checkAnswer(answer) {
    const a = answer;

    // Les r√®gles s'accumulent (toutes doivent √™tre vraies)
    // Pour appliquer √ßa proprement, on va v√©rifier toutes les r√®gles jusqu'√† la r√®gle courante

    for(let i=0; i<=step; i++){
      switch(i){
        case 0: // Majuscule initiale
          if(!/^[A-Z√Ä-√ñ√ô-√ù]/.test(a)) return false;
          break;
        case 1: // Voyelle accentu√©e
          if(!/[√©√®√™√´√†√¢√§√Æ√Ø√¥√∂√π√ª√º√ø]/i.test(a)) return false;
          break;
        case 2: // Apostrophe
          if(!a.includes("'")) return false;
          break;
        case 3: // Virgule
          if(!a.includes(",")) return false;
          break;
        case 4: // longueur 30-40 chars
          if(a.length < 30 || a.length > 40) return false;
          break;
        case 5: // 6 espaces
          if((a.match(/ /g) || []).length !== 6) return false;
          break;
        case 6: // 1er mot min 6 lettres
          if(getFirstWord(a).length < 6) return false;
          break;
        case 7: // dernier char '.'
          if(!a.endsWith('.')) return false;
          break;
        case 8: // mot de 2 lettres min
          if(!hasWordMinTwoLetters(a)) return false;
          break;
        case 9: // mot avec double 't'
          if(!/\b\w*t{2}\w*\b/i.test(a)) return false;
          break;
        case 10: // pas de 'z'
          if(/[zZ]/.test(a)) return false;
          break;
        case 11: // mot commence par 'j' minuscule
          if(!hasWordStartingJMin(a)) return false;
          break;
        case 12: // 'o' au moins 3 fois
          if((a.match(/o/gi) || []).length < 3) return false;
          break;
        case 13: // mot avec apostrophe commence par 't'
          if(!/\bt['‚Äô][a-zA-Z]+\b/i.test(a)) return false;
          break;
        case 14: // virgule entre 1er et 2eme mot
          {
            const words = a.trim().split(/\s+/);
            if(words.length < 2) return false;
            const first = words[0];
            const second = words[1];
            // V√©rifier si la virgule est juste apr√®s le premier mot (avec ou sans espace)
            // Donc v√©rifier si dans la cha√Æne originale la virgule est juste apr√®s first mot (sans espace)
            // Exemple "F√©licitations, je"
            const idxFirst = a.indexOf(first);
            const idxComma = a.indexOf(',');
            if(idxComma !== idxFirst + first.length) return false;
          }
          break;
        case 15: // nombre lettres sans espaces = 32
          if(countLetters(a) !== 32) return false;
          break;
        case 16: // pas de majuscule autre que 1er et dernier mot
          {
            const words = a.trim().split(/\s+/);
            if(words.length < 2) return false;
            const middleWords = words.slice(1, -1).join(' ');
            if(/[A-Z√Ä-√ñ√ô-√ù]/.test(middleWords)) return false;
          }
          break;
        case 17: // dernier mot commence par M
          {
            const words = a.trim().split(/\s+/);
            const lastWord = words[words.length -1].replace(/[.,!?;:]/g, '');
            if(!/^M/.test(lastWord)) return false;
          }
          break;
        case 18: // mot avec double 't' avant dernier mot
          {
            const words = a.trim().split(/\s+/);
            // Trouver mot avec double 't'
            const idxDoubleT = words.findIndex(w => /t{2}/i.test(w));
            if(idxDoubleT === -1) return false;
            if(idxDoubleT >= words.length - 1) return false;
          }
          break;
        case 19: // mot 'je' dans le texte
          if(!/\bje\b/.test(a)) return false;
          break;
        case 20: // mot avec apostrophe apr√®s 'je'
          {
            const words = a.trim().split(/\s+/);
            const idxJe = words.findIndex(w => w.toLowerCase() === "je");
            if(idxJe === -1 || idxJe + 1 >= words.length) return false;
            if(!/\bt['‚Äô][a-z]+\b/i.test(words[idxJe + 1])) return false;
          }
          break;
        case 21: // dernier mot = M√©diapart
          {
            const words = a.trim().split(/\s+/);
            const lastWord = words[words.length -1].replace(/[.,!?;:]/g, '');
            if(lastWord !== "M√©diapart") return false;
          }
          break;
        case 22: // contient 'abonnement'
          if(!/\babonnement\b/i.test(a)) return false;
          break;
        case 23: // sensible √† la casse
          // Pour forcer casse exacte, on peut comparer √† la phrase finale jusqu'√† step
          // Pour simplifier, on va juste exiger la casse exacte sur tout le texte (au moins jusqu'√† step)
          if(a !== a.trim()) return false;
          // et v√©rifier qu'il y a au moins une majuscule (pas juste tout en minuscules)
          if(!/[A-Z√Ä-√ñ√ô-√ù]/.test(a)) return false;
          break;
        case 24: // phrase exacte
          if(a !== finalPhrase) return false;
          break;
        default:
          return false;
      }
    }

    return true;
  }

  // Affiche toutes les r√®gles valid√©es + r√®gle courante
  function showRules() {
    rulesContainer.innerHTML = '';

    for(let i=0; i<=step; i++) {
      const div = document.createElement('div');
      div.classList.add('rule-item');
      if(i === step) div.classList.add('current');
      div.textContent = `R√®gle ${i+1}: ${rules[i]}`;
      rulesContainer.appendChild(div);
    }

    // Scroll vers le bas pour afficher la r√®gle courante
    rulesContainer.scrollTop = rulesContainer.scrollHeight;
  }

  // Mise √† jour stats essais et timer
  function updateStats() {
    const elapsedMs = Date.now() - startTime;
    const seconds = Math.floor(elapsedMs / 1000);
    const min = Math.floor(seconds / 60);
    const sec = seconds % 60;
    statsDiv.textContent = `Essais : ${attempts} | Temps √©coul√© : ${min}:${sec.toString().padStart(2,'0')}`;
  }

  // Confettis animation √† la fin
  function createConfetti() {
    const colors = ['#ffd700', '#ff6347', '#3cb371', '#00bfff', '#ff69b4'];
    for(let i=0; i<80; i++){
      const confetti = document.createElement('div');
      confetti.classList.add('confetti-piece');
      confetti.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
      confetti.style.left = Math.random()*100 + 'vw';
      confetti.style.animationDuration = (2 + Math.random()*3) + 's';
      confetti.style.animationDelay = (Math.random()*3) + 's';
      confetti.style.width = (5 + Math.random()*7) + 'px';
      confetti.style.height = (8 + Math.random()*10) + 'px';
      confetti.style.borderRadius = Math.random() > 0.5 ? '0' : '50% / 50%';
      document.body.appendChild(confetti);

      setTimeout(() => {
        confetti.remove();
      }, 6000);
    }
  }

  // Initialisation
  showRules();
  timerInterval = setInterval(updateStats, 1000);

  submitBtn.addEventListener('click', () => {
    const answer = answerInput.value.trim();
    if(answer.length === 0){
      messageDiv.textContent = "Merci d'√©crire une r√©ponse.";
      messageDiv.className = "error";
      playSound('error');
      return;
    }
    attempts++;
    if(checkAnswer(answer)){
      playSound('success');
      messageDiv.textContent = "Correct !";
      step++;
      if(step >= rules.length){
        // Fin du jeu
        messageDiv.innerHTML = `<strong>üéâ Bravo ! Vous avez compl√©t√© toutes les r√®gles ! üéâ</strong>`;
        createConfetti();
        submitBtn.disabled = true;
        answerInput.disabled = true;
        clearInterval(timerInterval);
        return;
      }
      showRules();
      answerInput.value = '';
    } else {
      messageDiv.textContent = "Erreur, essaie encore.";
      messageDiv.className = "error";
      playSound('error');
    }
    updateStats();
  });

  // Entr√©e clavier = validation
  answerInput.addEventListener('keydown', (e) => {
    if(e.key === 'Enter'){
      submitBtn.click();
    }
  });
</script>

</body>
</html>
