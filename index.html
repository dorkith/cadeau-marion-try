<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Jeu du mot de passe impossible</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0f0f23;
      color: #f2f2f2;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
    }
    input, button {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      margin-top: 10px;
    }
    button {
      background: #1f8a70;
      color: white;
      border: none;
      cursor: pointer;
    }
    .success { color: #4caf50; }
    .error { color: #f44336; }
    ul { padding-left: 20px; }
    #imageFlou, #audioSection, #videoSection, #gpsSection {
      margin-top: 15px;
      border: 1px solid #4caf50;
      padding: 10px;
      background: #142f2b;
      display: none;
    }
    #imageFlou img {
      width: 100%;
      filter: blur(10px);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß† Le Mot de Passe Impossible</h1>
    <h2>Respecte toutes les r√®gles pour trouver LA bonne phrase !</h2>

    <h3>R√®gles √† respecter :</h3>
    <ul id="rulesList"></ul>

    <input id="answerInput" type="text" placeholder="Tape ta proposition ici..." autocomplete="off">
    <button id="submitBtn">Valider</button>

    <p id="message"></p>
    <p id="stats"></p>

    <!-- Section image flout√©e -->
    <div id="imageFlou">
      <p>üîç Clique sur l'image pour la d√©flouter et d√©couvrir un indice, puis tape le mot cach√© :</p>
      <img id="blurImg" src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/Logo_Mediapart.svg/512px-Logo_Mediapart.svg.png" alt="Image Flout√©e" />
      <input id="imageInput" type="text" placeholder="Mot cach√© ici...">
      <button id="imageBtn">Valider mot cach√©</button>
      <p id="imageMessage"></p>
    </div>

    <!-- Section audio -->
    <div id="audioSection">
      <p>üîä √âcoute ce son, puis tape le mot entendu :</p>
      <audio id="audio" controls>
        <source src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" type="audio/ogg" />
        Ton navigateur ne supporte pas l'audio.
      </audio>
      <input id="audioInput" type="text" placeholder="Mot entendu ici...">
      <button id="audioBtn">Valider mot audio</button>
      <p id="audioMessage"></p>
    </div>

    <!-- Section vid√©o -->
    <div id="videoSection">
      <p>üé• Regarde cette vid√©o, puis tape le mot cl√© :</p>
      <video id="video" width="100%" controls>
        <source src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.webm" type="video/webm" />
        Ton navigateur ne supporte pas la vid√©o.
      </video>
      <input id="videoInput" type="text" placeholder="Mot cl√© vid√©o ici...">
      <button id="videoBtn">Valider mot vid√©o</button>
      <p id="videoMessage"></p>
    </div>

    <!-- Section GPS -->
    <div id="gpsSection">
      <p>üìç Entre une latitude et longitude proches de Paris :</p>
      <input id="latInput" type="number" step="0.0001" placeholder="Latitude (ex: 48.8566)" />
      <input id="lngInput" type="number" step="0.0001" placeholder="Longitude (ex: 2.3522)" />
      <button id="gpsBtn">Valider coordonn√©es</button>
      <p id="gpsMessage"></p>
    </div>
  </div>

<script>
  // Rules list simplifi√©e mais avec √©tapes interactives
  const rules = [
    {text: "La phrase commence par une majuscule.", test: str => /^[A-Z√Ä√Ç√Ñ√â√à√ä√ã√è√é√î√ñ√ô√õ√ú√á]/.test(str)},
    {text: "La phrase contient exactement 6 mots.", test: str => str.trim().split(/\s+/).length === 6},
    {text: "La phrase contient une virgule.", test: str => /,/.test(str)},
    {text: "La phrase se termine par un point.", test: str => /\.$/.test(str)},
    {text: "La phrase contient une apostrophe.", test: str => /‚Äô|\'/.test(str)},
    {text: "Chaque mot contient au moins une voyelle.", test: str => str.trim().split(/\s+/).every(w => /[aeiouy√†√¢√§√©√®√™√´√Ø√Æ√¥√∂√π√ª√º]/i.test(w))},
    {text: "Aucun mot ne contient la lettre ¬´ z ¬ª.", test: str => !/[zZ]/.test(str)},
    {text: "Aucun mot ne d√©passe 12 lettres.", test: str => str.trim().split(/\s+/).every(w => w.length <= 12)},
    {text: "La phrase contient le mot ¬´ un ¬ª.", test: str => /\bun\b/i.test(str)},
    {text: "La phrase ne contient ni chiffre ni symbole.", test: str => !/[\d@#$%^&*()_\-+=~`{}[\]|\\<>\/]/.test(str)},

    {text: "Elle contient un pronom personnel (je, tu, il...).", test: str => /\b(je|tu|il|elle|on|nous|vous|ils|elles)\b/i.test(str)},
    {text: "Elle contient une contraction fran√ßaise valide (ex : t'offre, j'aime...).", test: str => /\b(j'|t'|l'|n'|s')\w+/i.test(str)},
    {text: "Le premier mot a au moins 8 lettres.", test: str => str.trim().split(/\s+/)[0]?.length >= 8},
    {text: "Le deuxi√®me mot est plus court que le premier.", test: str => {
      const words = str.trim().split(/\s+/);
      return words.length >= 2 && words[1].length < words[0].length;
    }},
    {text: "Le mot apr√®s la virgule commence par un J.", test: str => {
      const afterComma = str.split(',')[1]?.trim();
      return afterComma ? /^j/i.test(afterComma) : false;
    }},
    {text: "Le mot final commence par un M majuscule.", test: str => {
      const lastWord = str.trim().split(/\s+/).pop();
      return lastWord?.startsWith("M");
    }},
    {text: "Le dernier mot contient exactement 9 lettres.", test: str => {
      const lastWord = str.trim().split(/\s+/).pop();
      return lastWord?.length === 9;
    }},
    {text: "Le mot 'abonnement' est pr√©sent, mais pas en derni√®re position.", test: str => {
      const words = str.trim().split(/\s+/);
      return words.includes("abonnement") && words[words.length-1] !== "abonnement." && words[words.length-1] !== "abonnement";
    }},
    {text: "Le mot ¬´ F√©licitation ¬ª contient 5 voyelles diff√©rentes.", test: str => {
      const m = str.match(/\bF√©licitation\b/i);
      if (!m) return false;
      const word = m[0].toLowerCase();
      const vowels = new Set(word.match(/[aeiouy√†√¢√§√©√®√™√´√Ø√Æ√¥√∂√π√ª√º]/g));
      return vowels.size >= 5;
    }},
    {text: "L‚Äôavant-dernier mot commence par un A.", test: str => {
      const words = str.trim().split(/\s+/);
      if(words.length < 2) return false;
      return words[words.length-2].startsWith('A') || words[words.length-2].startsWith('a');
    }},

    // Mini-jeu C√©sar : Le premier mot doit √™tre F√©licitation (clairement)
    {text: "Le premier mot est cod√© en code C√©sar +3. Tape ¬´ F√©licitation ¬ª en clair.", test: str => {
      const firstWord = str.trim().split(/\s+/)[0];
      // On demande juste que ce soit "F√©licitation"
      return firstWord === "F√©licitation";
    }},

    // Mini-jeu Acrostiche : la premi√®re lettre de chaque mot forme ¬´ FJETU ¬ª
    {text: "L'acrostiche form√© par la premi√®re lettre des mots est ¬´ FJETU ¬ª. (F√©licitation, je, t'offre, un...)", test: str => {
      const letters = str.trim().split(/\s+/).map(w => w[0].toUpperCase()).join('');
      return letters.startsWith("FJETU");
    }},

    // Mini-jeu Po√®me : il faut que la phrase contienne ¬´ t'offre ¬ª
    {text: "La phrase contient le mot ¬´ t'offre ¬ª.", test: str => /\bt'offre\b/.test(str)},

    // Inclinaison t√©l√©phone (interactif)
    {text: "Incline ton t√©l√©phone d‚Äôau moins 15¬∞ pour valider cette r√®gle.", test: () => inclinOk, interactive: true},

    // Image flout√©e (interactif)
    {text: "D√©floute l'image et tape le mot cach√©.", test: () => imageOk, interactive: true},

    // Audio (interactif)
    {text: "√âcoute le son et tape le mot entendu.", test: () => audioOk, interactive: true},

    // Vid√©o (interactif)
    {text: "Regarde la vid√©o et tape le mot cl√©.", test: () => videoOk, interactive: true},

    // GPS (interactif)
    {text: "Entre des coordonn√©es GPS proches de Paris.", test: () => gpsOk, interactive: true},

    // Phrase finale
    {text: "La phrase exacte est : F√©licitation, je t'offre un abonnement M√©diapart.", test: str => str === "F√©licitation, je t'offre un abonnement M√©diapart."},
  ];

  let step = 0, attempts = 0;
  const startTime = Date.now();

  const answerInput = document.getElementById("answerInput");
  const submitBtn = document.getElementById("submitBtn");
  const messageDiv = document.getElementById("message");
  const rulesList = document.getElementById("rulesList");
  const statsDiv = document.getElementById("stats");

  // Variables pour mini-jeux
  let inclinOk = false;
  let imageOk = false;
  let audioOk = false;
  let videoOk = false;
  let gpsOk = false;

  function showRules() {
    rulesList.innerHTML = "";
    for (let i = 0; i <= step; i++) {
      const li = document.createElement("li");
      li.textContent = rules[i].text;
      rulesList.appendChild(li);
    }

    // Afficher / cacher sections interactives selon la r√®gle active
    document.getElementById("imageFlou").style.display = (rules[step].text.includes("image")) ? "block" : "none";
    document.getElementById("audioSection").style.display = (rules[step].text.includes("son")) ? "block" : "none";
    document.getElementById("videoSection").style.display = (rules[step].text.includes("vid√©o")) ? "block" : "none";
    document.getElementById("gpsSection").style.display = (rules[step].text.includes("GPS")) ? "block" : "none";
  }

  // Inclinaison t√©l√©phone
  window.addEventListener("deviceorientation", e => {
    if(e.beta && Math.abs(e.beta) > 15) inclinOk = true;
  });

  // Image flout√©e
  const blurImg = document.getElementById("blurImg");
  const imageInput = document.getElementById("imageInput");
  const imageBtn = document.getElementById("imageBtn");
  const imageMessage = document.getElementById("imageMessage");
  blurImg.addEventListener("click", () => {
    blurImg.style.filter = "none";
  });
  imageBtn.addEventListener("click", () => {
    if(imageInput.value.trim().toLowerCase() === "m√©diapart") {
      imageOk = true;
      imageMessage.textContent = "‚úÖ Mot cach√© valid√© !";
      imageMessage.style.color = "#4caf50";
    } else {
      imageMessage.textContent = "‚ùå Mot incorrect.";
      imageMessage.style.color = "#f44336";
      imageOk = false;
    }
  });

  // Audio
  const audioInput = document.getElementById("audioInput");
  const audioBtn = document.getElementById("audioBtn");
  const audioMessage = document.getElementById("audioMessage");
  audioBtn.addEventListener("click", () => {
    if(audioInput.value.trim().toLowerCase() === "clang") {
      audioOk = true;
      audioMessage.textContent = "‚úÖ Mot audio valid√© !";
      audioMessage.style.color = "#4caf50";
    } else {
      audioMessage.textContent = "‚ùå Mot incorrect.";
      audioMessage.style.color = "#f44336";
      audioOk = false;
    }
  });

  // Vid√©o
  const videoInput = document.getElementById("videoInput");
  const videoBtn = document.getElementById("videoBtn");
  const videoMessage = document.getElementById("videoMessage");
  videoBtn.addEventListener("click", () => {
    if(videoInput.value.trim().toLowerCase() === "flower") {
      videoOk = true;
      videoMessage.textContent = "‚úÖ Mot vid√©o valid√© !";
      videoMessage.style.color = "#4caf50";
    } else {
      videoMessage.textContent = "‚ùå Mot incorrect.";
      videoMessage.style.color = "#f44336";
      videoOk = false;
    }
  });

  // GPS
  const latInput = document.getElementById("latInput");
  const lngInput = document.getElementById("lngInput");
  const gpsBtn = document.getElementById("gpsBtn");
  const gpsMessage = document.getElementById("gpsMessage");
  gpsBtn.addEventListener("click", () => {
    const lat = parseFloat(latInput.value);
    const lng = parseFloat(lngInput.value);
    // Coordonn√©es Paris approximatives 48.8566, 2.3522
    if(!isNaN(lat) && !isNaN(lng)) {
      const dist = Math.sqrt((lat - 48.8566)**2 + (lng - 2.3522)**2);
      if(dist < 0.05) {
        gpsOk = true;
        gpsMessage.textContent = "‚úÖ Coordonn√©es valid√©es !";
        gpsMessage.style.color = "#4caf50";
      } else {
        gpsOk = false;
        gpsMessage.textContent = "‚ùå Coordonn√©es trop √©loign√©es.";
        gpsMessage.style.color = "#f44336";
      }
    } else {
      gpsOk = false;
      gpsMessage.textContent = "‚ùå Entr√©e invalide.";
      gpsMessage.style.color = "#f44336";
    }
  });

  submitBtn.addEventListener("click", () => {
    const input = answerInput.value.trim();
    if (!input) return;

    attempts++;

    // Pour r√®gles interactives, pas besoin d‚Äôinput (on v√©rifie la variable bool√©enne)
    const allPassed = rules.slice(0, step + 1).every(rule => {
      if(rule.interactive) return rule.test();
      return rule.test(input);
    });

    if (allPassed) {
      if (step < rules.length - 1) {
        messageDiv.textContent = "‚úÖ Bien jou√©, r√®gle valid√©e !";
        messageDiv.className = "success";
        step++;
        showRules();
      } else {
        messageDiv.textContent = "üéâ F√©licitations ! Tu as trouv√© la phrase parfaite.";
        messageDiv.className = "success";
        submitBtn.disabled = true;
      }
    } else {
      messageDiv.textContent = "‚ùå Oups, ta phrase ne respecte pas toutes les r√®gles.";
      messageDiv.className = "error";
    }

    statsDiv.textContent = `Tentatives : ${attempts} | Temps √©coul√© : ${Math.floor((Date.now() - startTime) / 1000)} sec`;
  });

  answerInput.addEventListener("keypress", e => {
    if (e.key === "Enter") submitBtn.click();
  });

  showRules();
</script>

</body>
</html>
