<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Le Mot de Passe Impossible</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0f0f23;
      color: #fff;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
    }
    input, button {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      margin-top: 10px;
    }
    button {
      background: #1f8a70;
      color: white;
      border: none;
      cursor: pointer;
    }
    .success { color: #4caf50; }
    .error { color: #f44336; }
    .hidden { display: none; }
    .image-challenge, .tilt-challenge, .drag-container { margin-top: 20px; }
    .drag-item { display: inline-block; padding: 10px; background: #333; margin: 5px; cursor: grab; }
    .drop-zone { padding: 20px; border: 2px dashed #aaa; min-height: 50px; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß† Le Mot de Passe Impossible</h1>
    <h2>Respecte toutes les r√®gles et surmonte les mini-jeux !</h2>
    <h3>R√®gles d√©bloqu√©es :</h3>
    <ul id="rulesList"></ul>

    <input id="answerInput" type="text" placeholder="Tape ta proposition ici...">
    <button id="submitBtn">Valider</button>

    <p id="message"></p>
    <p id="stats"></p>

    <!-- Image Challenge -->
    <div class="image-challenge hidden" id="imageChallenge">
      <h3>üîç Quel est cet objet ?</h3>
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/63/Mona_Lisa_detail_face.jpg/240px-Mona_Lisa_detail_face.jpg" style="filter: blur(5px);">
      <input id="imageAnswer" placeholder="Tape ta r√©ponse ici...">
      <button onclick="validateImageChallenge()">Valider</button>
    </div>

    <!-- Tilt Challenge -->
    <div class="tilt-challenge hidden" id="tiltChallenge">
      <h3>üì± Incline ton t√©l√©phone vers la droite pour continuer</h3>
    </div>

    <!-- Drag & Drop Challenge -->
    <div class="drag-container hidden" id="dragChallenge">
      <h3>üß© Remets les mots dans le bon ordre</h3>
      <div id="dragItems"></div>
      <div class="drop-zone" id="dropZone"></div>
      <button onclick="validateDrag()">Valider l'ordre</button>
    </div>
  </div>

  <script>
    const rules = [
      { text: "La phrase commence par une majuscule.", test: str => /^[A-Z]/.test(str) },
      { text: "Elle contient exactement 6 mots.", test: str => str.trim().split(/\s+/).length === 6 },
      { text: "Elle contient une virgule.", test: str => /,/.test(str) },
      { text: "Un mot a exactement 4 lettres.", test: str => str.split(/\s+/).some(w => w.length === 4) },
      { text: "Elle contient au moins 3 lettres accentu√©es.", test: str => (str.match(/[√†√¢√§√©√®√™√´√Ø√Æ√¥√∂√π√ª√º√ß]/gi) || []).length >= 3 },
      { text: "Pas de r√©p√©tition de mots.", test: str => {
        let words = str.toLowerCase().split(/\s+/);
        return new Set(words).size === words.length;
      } },
      { text: "Elle contient un emoji.", test: str => /\p{Emoji}/u.test(str) },
      { text: "Elle contient un mot avec le son 'ch'.", test: str => /ch/i.test(str) },
      { text: "Le mot final est en majuscules.", test: str => str.trim().split(/\s+/).pop() === str.trim().split(/\s+/).pop().toUpperCase() },
      { text: "Phrase exacte attendue.", test: str => str === "F√©licitation, je t'offre un abonnement M√©diapart." }
    ];

    let step = 0;
    let attempts = 0;
    const startTime = Date.now();

    const answerInput = document.getElementById("answerInput");
    const submitBtn = document.getElementById("submitBtn");
    const messageDiv = document.getElementById("message");
    const rulesList = document.getElementById("rulesList");
    const statsDiv = document.getElementById("stats");

    function showRules() {
      rulesList.innerHTML = "";
      for (let i = 0; i <= step; i++) {
        const li = document.createElement("li");
        li.textContent = rules[i].text;
        rulesList.appendChild(li);
      }
    }

    submitBtn.addEventListener("click", () => {
      const input = answerInput.value.trim();
      if (!input) return;

      attempts++;

      const allPassed = rules.slice(0, step + 1).every(rule => rule.test(input));

      if (allPassed) {
        step++;
        if (step < rules.length) {
          messageDiv.textContent = "‚úÖ R√®gle valid√©e.";
          messageDiv.className = "success";
          triggerMiniGame(step);
          showRules();
        } else {
          messageDiv.textContent = "üéâ Phrase finale correcte ! Bien jou√© !";
          messageDiv.className = "success";
          submitBtn.disabled = true;
        }
      } else {
        messageDiv.textContent = "‚ùå Essaie encore, certaines r√®gles ne sont pas respect√©es.";
        messageDiv.className = "error";
      }

      statsDiv.textContent = `Tentatives : ${attempts} | Temps √©coul√© : ${Math.floor((Date.now() - startTime) / 1000)} sec`;
    });

    answerInput.addEventListener("keypress", e => {
      if (e.key === "Enter") submitBtn.click();
    });

    showRules();

    // Mini-jeux :
    function triggerMiniGame(step) {
      document.getElementById("imageChallenge").classList.add("hidden");
      document.getElementById("tiltChallenge").classList.add("hidden");
      document.getElementById("dragChallenge").classList.add("hidden");

      if (step === 3) document.getElementById("imageChallenge").classList.remove("hidden");
      if (step === 5) document.getElementById("tiltChallenge").classList.remove("hidden");
      if (step === 7) setupDragDrop();
    }

    function validateImageChallenge() {
      const val = document.getElementById("imageAnswer").value.trim().toLowerCase();
      if (val.includes("mona") || val.includes("lisa")) {
        document.getElementById("imageChallenge").classList.add("hidden");
        alert("Bonne r√©ponse ! Continue.");
      } else {
        alert("Incorrect. Indice : c'est un tableau c√©l√®bre.");
      }
    }

    window.addEventListener("deviceorientation", event => {
      const gamma = event.gamma;
      if (document.getElementById("tiltChallenge").classList.contains("hidden")) return;
      if (gamma > 30) {
        document.getElementById("tiltChallenge").classList.add("hidden");
        alert("Inclinaison d√©tect√©e ! Tu peux continuer.");
      }
    });

    function setupDragDrop() {
      const words = ["abonnement", "je", "offre", "M√©diapart", "t'", "un"];
      const shuffled = words.sort(() => Math.random() - 0.5);
      const container = document.getElementById("dragItems");
      const dropZone = document.getElementById("dropZone");
      container.innerHTML = "";
      dropZone.innerHTML = "";

      shuffled.forEach(word => {
        const div = document.createElement("div");
        div.className = "drag-item";
        div.draggable = true;
        div.textContent = word;
        div.addEventListener("dragstart", e => e.dataTransfer.setData("text/plain", word));
        container.appendChild(div);
      });

      dropZone.addEventListener("dragover", e => e.preventDefault());
      dropZone.addEventListener("drop", e => {
        e.preventDefault();
        const data = e.dataTransfer.getData("text/plain");
        const div = document.createElement("div");
        div.className = "drag-item";
        div.textContent = data;
        dropZone.appendChild(div);
      });

      document.getElementById("dragChallenge").classList.remove("hidden");
    }

    function validateDrag() {
      const result = Array.from(document.querySelectorAll("#dropZone .drag-item")).map(div => div.textContent).join(" ");
      if (result.toLowerCase() === "je t' offre un abonnement m√©diapart") {
        document.getElementById("dragChallenge").classList.add("hidden");
        alert("Ordre correct ! Continue le jeu.");
      } else {
        alert("Ordre incorrect, recommence.");
      }
    }
  </script>
</body>
</html>
