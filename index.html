<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Jeu mot de passe progressif (25 rÃ¨gles)</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2em auto; }
  input { width: 100%; padding: 0.5em; font-size: 1.2em; }
  button { margin-top: 1em; padding: 0.7em 1.2em; font-size: 1.1em; }
  .success { color: green; margin-top: 1em; }
  .error { color: red; margin-top: 1em; }
  .rule { font-style: italic; margin-top: 1em; }
</style>
</head>
<body>

<h2>Jeu du mot de passe progressif (25 rÃ¨gles)</h2>
<p>Construis la phrase finale en respectant chaque contrainte, une par une.</p>

<div id="rule" class="rule"></div>

<input type="text" id="answer" placeholder="Ta rÃ©ponse ici" autofocus autocomplete="off" />
<button id="submitBtn">Valider</button>

<div id="message"></div>

<script>
  const finalPhrase = "FÃ©licitations, je t'offre un abonnement MÃ©diapart.";

  const rules = [
    "La rÃ©ponse commence par une majuscule.",
    "La rÃ©ponse contient une virgule.",
    "La rÃ©ponse contient le mot entier Â« je Â».",
    "La rÃ©ponse contient la contraction Â« t'offre Â» avec apostrophe.",
    "La rÃ©ponse contient le mot Â« un Â».",
    "La rÃ©ponse contient le mot Â« abonnement Â».",
    "La rÃ©ponse contient le mot Â« MÃ©diapart Â» avec majuscule et accent.",
    "La phrase finit par un point.",
    "La phrase comporte exactement 7 mots.",
    "La phrase comporte exactement 38 caractÃ¨res (espaces compris).",
    "La rÃ©ponse commence par Â« FÃ©licitations Â».",
    "La virgule est juste aprÃ¨s Â« FÃ©licitations Â».",
    "Il y a exactement 6 espaces dans la phrase.",
    "Le mot Â« je Â» est avant le mot Â« t'offre Â».",
    "Le mot Â« abonnement Â» est avant le mot Â« MÃ©diapart Â».",
    "Le mot Â« t'offre Â» est prÃ©cÃ©dÃ© par le mot Â« je Â».",
    "Le mot Â« MÃ©diapart Â» est le dernier mot avant le point.",
    "La phrase contient un apostrophe (').",
    "Le mot Â« je Â» est Ã©crit en minuscules.",
    "La premiÃ¨re lettre de chaque mot est soit une majuscule (pour Â« FÃ©licitations Â» et Â« MÃ©diapart Â») ou une minuscule.",
    "La phrase ne contient aucun autre signe de ponctuation que la virgule et le point final.",
    "La phrase ne contient pas de double espace.",
    "La phrase ne contient pas le mot Â« offre Â» tout seul (doit Ãªtre Â« t'offre Â»).",
    "La phrase est sensible Ã  la casse (respect exact des majuscules/minuscules).",
    "La rÃ©ponse est strictement Ã©gale Ã  :<br><strong>FÃ©licitations, je t'offre un abonnement MÃ©diapart.</strong>"
  ];

  let step = 0;

  const ruleDiv = document.getElementById('rule');
  const answerInput = document.getElementById('answer');
  const submitBtn = document.getElementById('submitBtn');
  const messageDiv = document.getElementById('message');

  function showRule() {
    ruleDiv.innerHTML = `RÃ¨gle #${step + 1} : ${rules[step]}`;
    messageDiv.textContent = "";
    answerInput.value = "";
    answerInput.focus();
  }

  function countWords(str) {
    return str.trim().split(/\s+/).length;
  }

  function checkCapitalization(word, isFirstOrLast=false) {
    if (isFirstOrLast) {
      // Doit commencer par majuscule
      return /^[A-ZÃ€Ã‚Ã‰ÃˆÃŠÃ‹ÃÃÃ”Ã™Ã›ÃœÃ‡]/.test(word);
    } else {
      // Doit commencer par minuscule
      return /^[a-zÃ Ã¢Ã©Ã¨ÃªÃ«Ã®Ã¯Ã´Ã¹Ã»Ã¼Ã§]/.test(word);
    }
  }

  function checkAnswer(answer) {
    switch(step) {
      case 0:
        // Commence par une majuscule
        return /^[A-ZÃ€Ã‚Ã‰ÃˆÃŠÃ‹ÃÃÃ”Ã™Ã›ÃœÃ‡]/.test(answer);
      case 1:
        // Contient une virgule
        return answer.includes(',');
      case 2:
        // Contient le mot 'je' (mot entier)
        return /\bje\b/.test(answer);
      case 3:
        // Contient "t'offre"
        return answer.includes("t'offre");
      case 4:
        // Contient le mot 'un'
        return /\bun\b/.test(answer);
      case 5:
        // Contient 'abonnement'
        return answer.includes('abonnement');
      case 6:
        // Contient 'MÃ©diapart' (majuscule et accent)
        return answer.includes('MÃ©diapart');
      case 7:
        // Finit par un point
        return answer.endsWith('.');
      case 8:
        // 7 mots exactement
        return countWords(answer) === 7;
      case 9:
        // 38 caractÃ¨res (espaces compris)
        return answer.length === 38;
      case 10:
        // Commence par 'FÃ©licitations'
        return answer.startsWith('FÃ©licitations');
      case 11:
        // Virgule juste aprÃ¨s 'FÃ©licitations'
        return answer.indexOf(',') === 'FÃ©licitations'.length;
      case 12:
        // 6 espaces dans la phrase
        return (answer.match(/ /g) || []).length === 6;
      case 13:
        // 'je' avant 't'offre'
        return answer.indexOf('je') < answer.indexOf("t'offre");
      case 14:
        // 'abonnement' avant 'MÃ©diapart'
        return answer.indexOf('abonnement') < answer.indexOf('MÃ©diapart');
      case 15:
        // 't'offre' prÃ©cÃ©dÃ© par 'je' (mots consÃ©cutifs)
        // On cherche "je t'offre"
        return /\bje t'offre\b/.test(answer);
      case 16:
        // 'MÃ©diapart' est dernier mot avant le point
        // On vÃ©rifie que "MÃ©diapart." est la fin ou que le mot avant le point est MÃ©diapart
        return answer.endsWith('MÃ©diapart.');
      case 17:
        // Contient un apostrophe
        return answer.includes("'");
      case 18:
        // 'je' est en minuscules (on cherche exactement 'je', pas 'Je')
        return /\bje\b/.test(answer) && !/\bJe\b/.test(answer);
      case 19:
        // PremiÃ¨re lettre de chaque mot : majuscule seulement pour "FÃ©licitations" et "MÃ©diapart", minuscule sinon
        const words = answer.split(' ');
        if (words.length !==7) return false;
        if (!checkCapitalization(words[0], true)) return false; // FÃ©licitations avec majuscule
        for(let i=1; i < words.length - 1; i++){
          if (!checkCapitalization(words[i], false)) return false; // minuscule pour les autres mots intermÃ©diaires
        }
        if (!checkCapitalization(words[words.length -1], true)) return false; // MÃ©diapart majuscule
        return true;
      case 20:
        // Pas d'autre ponctuation que virgule et point final
        return !/[;:!?]/.test(answer);
      case 21:
        // Pas de double espace
        return !answer.includes("  ");
      case 22:
        // Pas le mot 'offre' tout seul (doit Ãªtre "t'offre")
        return !/\boffre\b/.test(answer);
      case 23:
        // Sensible Ã  la casse (on compare exactement)
        return answer === answer;
      case 24:
        // RÃ©ponse exacte finale
        return answer === finalPhrase;
      default:
        return false;
    }
  }

  submitBtn.addEventListener('click', () => {
    const answer = answerInput.value.trim();

    if (checkAnswer(answer)) {
      step++;
      if (step === rules.length) {
        messageDiv.innerHTML = "<span class='success'>Bravo ! Tu as rÃ©ussi Ã  construire la phrase finale ! ğŸ‰</span>";
        ruleDiv.textContent = "";
        answerInput.disabled = true;
        submitBtn.disabled = true;
      } else {
        messageDiv.innerHTML = "<span class='success'>Correct ! Passons Ã  la rÃ¨gle suivante.</span>";
        showRule();
      }
    } else {
      messageDiv.innerHTML = "<span class='error'>Oups, cette rÃ©ponse ne respecte pas la rÃ¨gle. Essaie encore !</span>";
    }
  });

  // DÃ©marrage
  showRule();
</script>

</body>
</html>
