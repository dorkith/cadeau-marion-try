<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Jeu du mot de passe impossible</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0f0f23;
      color: #f2f2f2;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1, h2, h3 {
      text-align: center;
    }
    input, button {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      margin-top: 10px;
      border: none;
      border-radius: 4px;
    }
    button {
      background: #1f8a70;
      color: white;
      cursor: pointer;
    }
    .success { color: #4caf50; }
    .error { color: #f44336; }
    ul { padding-left: 20px; }
    #rulesList li.valid { text-decoration: line-through; color: #4caf50; }
  </style>
</head>
<body>
  <h1>🧠 Le Mot de Passe Impossible</h1>
  <h2>Respecte toutes les règles pour avancer</h2>

  <h3>Règles à valider :</h3>
  <ul id="rulesList"></ul>

  <input id="answerInput" type="text" placeholder="Tape ta proposition ici..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
  <button id="submitBtn">Valider</button>

  <p id="message"></p>
  <p id="stats"></p>

  <script>
    const rules = [
      {
        text: "La phrase commence par une majuscule.",
        test: str => /^[A-ZÀÂÄÉÈÊËÏÎÔÖÙÛÜÇ]/.test(str.trim())
      },
      {
        text: "La phrase contient exactement 6 mots.",
        test: str => str.trim().split(/\s+/).length === 6
      },
      {
        text: "La phrase contient une virgule.",
        test: str => /,/.test(str)
      },
      {
        text: "Un mot de la phrase a exactement 4 lettres.",
        test: str => str.trim().split(/\s+/).some(w => w.replace(/[.,!?:;]/g,'').length === 4)
      },
      {
        text: "La phrase contient au moins 3 lettres accentuées.",
        test: str => {
          const accents = str.match(/[àâäéèêëïîôöùûüç]/gi);
          return accents && accents.length >= 3;
        }
      },
      {
        text: "Aucun mot n'est répété.",
        test: str => {
          const words = str.toLowerCase().match(/\b\w+\b/g);
          return words && (new Set(words)).size === words.length;
        }
      },
      {
        text: "La phrase contient au moins un emoji.",
        test: str => {
          // Emoji regex simplifiée
          return /[\u231A-\uD83E\uDDFF]/.test(str);
        }
      },
      {
        text: "Le premier mot après la virgule commence par une lettre entre A et M.",
        test: str => {
          const parts = str.split(',');
          if(parts.length < 2) return false;
          const firstWordAfterComma = parts[1].trim().split(/\s+/)[0];
          return /^[A-Ma-m]/.test(firstWordAfterComma);
        }
      },
      {
        text: "Le dernier mot contient entre 5 et 10 lettres.",
        test: str => {
          const lastWord = str.trim().split(/\s+/).pop().replace(/[.,!?:;]/g,'');
          return lastWord.length >=5 && lastWord.length <= 10;
        }
      },
      {
        text: "Tous les mots commencent par une lettre différente quand triés alphabétiquement.",
        test: str => {
          const words = str.toLowerCase().match(/\b\w+\b/g);
          if (!words) return false;
          const sorted = words.slice().sort();
          for(let i = 1; i < sorted.length; i++) {
            if(sorted[i][0] === sorted[i-1][0]) return false;
          }
          return true;
        }
      }
    ];

    let step = 0;
    let attempts = 0;
    const startTime = Date.now();

    const answerInput = document.getElementById("answerInput");
    const submitBtn = document.getElementById("submitBtn");
    const messageDiv = document.getElementById("message");
    const rulesList = document.getElementById("rulesList");
    const statsDiv = document.getElementById("stats");

    function updateRulesList() {
      rulesList.innerHTML = "";
      rules.forEach((rule, index) => {
        const li = document.createElement("li");
        li.textContent = rule.text;
        if(index < step) li.classList.add("valid");
        rulesList.appendChild(li);
      });
    }

    function testCurrentRule(input) {
      return rules[step].test(input);
    }

    submitBtn.addEventListener("click", () => {
      const input = answerInput.value.trim();
      if(!input) return;

      attempts++;

      if(testCurrentRule(input)) {
        messageDiv.textContent = `✅ Règle ${step + 1} validée !`;
        messageDiv.className = "success";
        step++;
        if(step === rules.length) {
          messageDiv.textContent = "🎉 Félicitations ! Tu as validé toutes les règles.";
          submitBtn.disabled = true;
          answerInput.disabled = true;
        }
        updateRulesList();
      } else {
        messageDiv.textContent = `❌ La phrase ne respecte pas la règle ${step + 1} : "${rules[step].text}"`;
        messageDiv.className = "error";
      }
      statsDiv.textContent = `Tentatives : ${attempts} | Temps écoulé : ${Math.floor((Date.now() - startTime)/1000)} sec`;
    });

    answerInput.addEventListener("keypress", e => {
      if(e.key === "Enter") submitBtn.click();
    });

    updateRulesList();
  </script>
</body>
</html>
