<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Jeu du mot de passe impossible</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0f0f23;
      color: #f2f2f2;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
    }
    input, button {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      margin-top: 10px;
    }
    button {
      background: #1f8a70;
      color: white;
      border: none;
      cursor: pointer;
    }
    .success { color: #4caf50; }
    .error { color: #f44336; }
    ul { padding-left: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🧠 Le Mot de Passe Impossible</h1>
    <h2>Respecte toutes les règles pour trouver LA bonne phrase !</h2>

    <h3>Règles à respecter :</h3>
    <ul id="rulesList"></ul>

    <input id="answerInput" type="text" placeholder="Tape ta proposition ici...">
    <button id="submitBtn">Valider</button>

    <p id="message"></p>
    <p id="stats"></p>
  </div>

  <script>
    const rules = [
      {text: "Commence par une majuscule.", test: str => /^[A-ZÀÂÄÉÈÊËÏÎÔÖÙÛÜÇ]/.test(str)},
      {text: "Contient exactement 6 mots.", test: str => str.trim().split(/\s+/).length === 6},
      {text: "Contient une virgule.", test: str => /,/.test(str)},
      {text: "Contient un pronom personnel (je, tu, il...).", test: str => /\b(je|tu|il|elle|on|nous|vous|ils|elles)\b/i.test(str)},
      {text: "Contient une contraction (ex: t'offre, j'aime...).", test: str => /\b(j'|t'|l'|n'|s')\w+/i.test(str)},
      {text: "Contient au moins 3 lettres accentuées.", test: str => [...str].filter(c => "àâäéèêëïîôöùûüç".includes(c.toLowerCase())).length >= 3},
      {text: "Le mot juste après la virgule commence par un J.", test: str => str.split(',')[1]?.trim()?.startsWith('j') || false},
      {text: "Le mot 'abonnement' est présent mais n'est pas le dernier mot.", test: str => str.includes("abonnement") && !str.trim().endsWith("abonnement.")},
      {text: "Le mot final commence par un M majuscule.", test: str => str.trim().split(/\s+/).pop()?.startsWith("M")},
      {text: "La phrase exacte est : Félicitation, je t'offre un abonnement Médiapart.", test: str => str === "Félicitation, je t'offre un abonnement Médiapart."}
    ];

    let step = 0, attempts = 0;
    const startTime = Date.now();

    const answerInput = document.getElementById("answerInput");
    const submitBtn = document.getElementById("submitBtn");
    const messageDiv = document.getElementById("message");
    const rulesList = document.getElementById("rulesList");
    const statsDiv = document.getElementById("stats");

    function showRules() {
      rulesList.innerHTML = "";
      for (let i = 0; i <= step; i++) {
        const li = document.createElement("li");
        li.textContent = rules[i].text;
        rulesList.appendChild(li);
      }
    }

    submitBtn.addEventListener("click", () => {
      const input = answerInput.value.trim();
      if (!input) return;

      attempts++;

      const allPassed = rules.slice(0, step + 1).every(rule => rule.test(input));

      if (allPassed) {
        if (step < rules.length - 1) {
          messageDiv.textContent = "✅ Bien joué, règle validée !";
          messageDiv.className = "success";
          step++;
          showRules();
        } else {
          messageDiv.textContent = "🎉 Félicitations ! Tu as trouvé la phrase parfaite.";
          messageDiv.className = "success";
          submitBtn.disabled = true;
        }
      } else {
        messageDiv.textContent = "❌ Oups, ta phrase ne respecte pas toutes les règles.";
        messageDiv.className = "error";
      }

      statsDiv.textContent = `Tentatives : ${attempts} | Temps écoulé : ${Math.floor((Date.now() - startTime) / 1000)} sec`;
    });

    answerInput.addEventListener("keypress", e => {
      if (e.key === "Enter") submitBtn.click();
    });

    showRules();
  </script>
</body>
</html>
